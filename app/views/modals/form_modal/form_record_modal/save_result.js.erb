<% record = modal.form.record %>
<% table = modal.table %>
var modal_id = '<%= modal.id %>';
<% if modal.form.submit_success %>
  hideModal(modal_id);
  <% if !table.nil? %>
    function renderRecord() {
      return '<%= j render partial: modal.page.record_html_path, locals: { record: record, table: table } %>'
    }
    var trow = '#<%= table.row_id(record) %>'
    <% if modal.role?(:new_create) %>
      var tbody = '.<%= table.body_class %>';
      <% if table.insert_method == Table::Insert::PREPEND %>
        $(tbody).prepend(renderRecord());
      <% elsif table.insert_method == Table::Insert::APPEND %>
        $(tbody).append(renderRecord());
      <% end %>
      $().hide(trow).fadeIn(1000);
    <% elsif modal.role?(:edit_update) %>
      $(trow).replaceWith(renderRecord());
    <% elsif modal.role?(:destroy) %>
      $(trow).fadeOut(500, function(){
        $(this).remove();
      });
    <% end %>
  <% end %>
  alert_custom('<%= Constants::Alert::SUCCESS %>', '<%= t "alert.save.success" %>');
<% else %>
  $("#<%= modal.form.html_id %>").replaceWith("<%=  j render modal.form.view_path, modal: modal %>");
<% end %>
